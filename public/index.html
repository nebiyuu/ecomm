<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ecom API Reference</title>
  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 32px; line-height: 1.4; }
    h1 { margin-bottom: 4px; }
    h2 { margin-top: 28px; border-bottom: 1px solid #ccc; padding-bottom: 4px; }
    h3 { margin-top: 18px; }
    code, pre { background: color-mix(in oklab, Canvas 92%, black 8%); padding: 2px 6px; border-radius: 6px; }
    pre { padding: 12px; overflow: auto; }
    .endpoint { margin: 14px 0; padding: 12px; border: 1px solid #ddd; border-radius: 8px; }
    .method { font-weight: 700; }
    .pill { display: inline-block; padding: 2px 8px; border-radius: 999px; font-size: 12px; font-weight: 600; margin-left: 6px; }
    .auth { background: #e1f5fe; color: #01579b; }
    .protected { background: #f3e5f5; color: #4a148c; }
    .note { font-size: 13px; color: #666; }
    ul { margin: 8px 0 0 18px; }
    .grid { display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
  </style>
</head>
<body>
  <h1>Ecom API Reference</h1>
  <div class="note">Base URL: <code>/api</code>. All request/response bodies are JSON.</div>

  <h2>Users (Unified auth)</h2>



  <div class="endpoint">
    <div><span class="method">DELETE</span> <code>/api/users/:id</code> <span class="pill protected">JWT</span></div>
    <div>Deletes the user and related Seller/Buyer records. Only the same user or an admin can perform this.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
      <li>Params: <code>id</code> — User ID</li>
      <li>Body: none</li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "message": "User and related records deleted" }</code></li>
      <li>401: <code>{ "message": "Unauthorized" }</code></li>
      <li>403: <code>{ "message": "Forbidden" }</code></li>
      <li>404: <code>{ "message": "User not found" }</code></li>
      <li>500: <code>{ "message": "Error deleting user", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">POST</span> <code>/api/users/resend-otp</code> <span class="pill auth">Public</span></div>
    <div>Resends a new verification code (buyers or sellers).</div>
    <h4>Request body</h4>
<pre>{
  "email": "user@example.com"
}</pre>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "message": "OTP resent to buyer/seller email" }</code></li>
      <li>400 | 404 | 200 (already verified): same as send-otp</li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">POST</span> <code>/api/users/verify-email</code> <span class="pill auth">Public</span></div>
    <div>Verifies the code, marks emailVerified, ensures a User exists, and returns JWT.</div>
    <h4>Request body</h4>
<pre>{
  "email": "user@example.com",
  "otp": "123456"
}</pre>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ message, token, user: { id, username, email, role } }</code></li>
      <li>400: <code>email and otp required | No OTP pending | OTP expired | Invalid OTP</code></li>
      <li>404: <code>Account not found</code></li>
      <li>429: <code>Too many attempts. Request a new OTP</code></li>
      <li>200 (already verified): <code>{ "message": "Email already verified" }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">POST</span> <code>/api/users/login</code> <span class="pill auth">Public</span></div>
    <div>Universal login for buyer, seller, and admin. Role is resolved from User.</div>
    <h4>Request body</h4>
<pre>{
  "username": "username-or-email",
  "password": "secret"
}</pre>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ message, token, user: { id, username, email, role } }</code></li>
      <li>400/401/404: <code>User not found | Invalid password | All fields required</code></li>
      <li>403 (buyer/seller): <code>Email not verified</code></li>
      <li>403 (seller): <code>Seller not approved yet</code></li>
    </ul>
  </div>

  <h2>Products</h2>

  <div class="endpoint">
    <div><span class="method">GET</span> <code>/api/products</code> <span class="pill auth">Public</span></div>
    <div>Lists all products. Admins can see soft-deleted products as well.</div>
    <h4>Request</h4>
    <ul>
      <li>No authentication required for basic listing</li>
      <li>Admins can include deleted products in results</li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "success": true, "count": number, "data": Product[] }</code></li>
      <li>500: <code>{ "success": false, "message": "Error retrieving products", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">GET</span> <code>/api/products/:id</code> <span class="pill auth">Public</span></div>
    <div>Get a specific product by ID.</div>
    <h4>Request</h4>
    <ul>
      <li>Params: <code>id</code> — Product ID (required)</li>
      <li>Admins can retrieve soft-deleted products</li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "success": true, "data": Product }</code></li>
      <li>404: <code>{ "success": false, "message": "Product not found" }</code></li>
      <li>500: <code>{ "success": false, "message": "Error retrieving product", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">POST</span> <code>/api/products</code> <span class="pill protected">JWT (Seller/Admin)</span></div>
    <div>Creates a new product. Only authenticated sellers or admins can create products.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
      <li>Body (JSON):
<pre>{
  "name": "string (required, min 3, max 100 chars)",
  "description": "string (required, min 10 chars)",
  "category": "string (required)",
  "condition": "string (optional, enum: ['new', 'used', 'refurbished'], default: 'new')",
  "price": "number (required, > 0)",
  "images": "string[] (optional, array of image URLs)",
  "ownerId": "number (optional, admin only - for assigning product to specific seller)"
}</pre>
      </li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>201: <code>{ "success": true, "data": Product }</code></li>
      <li>400: <code>{ "success": false, "message": "Validation error", "errors": [...] }</code></li>
      <li>401: <code>{ "success": false, "message": "Unauthorized" }</code></li>
      <li>403: <code>{ "success": false, "message": "Only sellers and admins can create products" }</code></li>
      <li>500: <code>{ "success": false, "message": "Error creating product", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">PUT</span> <code>/api/products/:id</code> <span class="pill protected">JWT (Owner/Admin)</span></div>
    <div>Updates an existing product. Only the product owner or admin can update it.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
      <li>Params: <code>id</code> — Product ID to update (required)</li>
      <li>Body (JSON, all fields optional except for the ones being updated):
<pre>{
  "name": "string (min 3, max 100 chars)",
  "description": "string (min 10 chars)",
  "category": "string",
  "condition": "string (enum: ['new', 'used', 'refurbished'])",
  "price": "number (> 0)",
  "images": "string[] (array of image URLs)",
  "ownerId": "number (admin only - for transferring product ownership)"
}</pre>
      </li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "success": true, "data": UpdatedProduct }</code></li>
      <li>400: <code>{ "success": false, "message": "Validation error", "errors": [...] }</code></li>
      <li>401: <code>{ "success": false, "message": "Unauthorized" }</code></li>
      <li>403: <code>{ "success": false, "message": "Not authorized to update this product" }</code></li>
      <li>404: <code>{ "success": false, "message": "Product not found" }</code></li>
      <li>500: <code>{ "success": false, "message": "Error updating product", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">DELETE</span> <code>/api/products/:id</code> <span class="pill protected">JWT (Owner/Admin)</span></div>
    <div>Soft deletes a product. Only the product owner or admin can delete it. The product is not actually removed from the database but marked as deleted.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
      <li>Params: <code>id</code> — Product ID to delete (required)</li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "success": true, "message": "Product deleted successfully" }</code></li>
      <li>401: <code>{ "success": false, "message": "Unauthorized" }</code></li>
      <li>403: <code>{ "success": false, "message": "Not authorized to delete this product" }</code></li>
      <li>404: <code>{ "success": false, "message": "Product not found" }</code></li>
      <li>500: <code>{ "success": false, "message": "Error deleting product", "error": "..." }</code></li>
    </ul>
  </div>

  <h2>Buyers</h2>

  <div class="endpoint">
    <div><span class="method">POST</span> <code>/api/buyers/register</code> <span class="pill auth">Public</span></div>
    <div>Registers a buyer and sends OTP.</div>
    <h4>Request body</h4>
<pre>{
  "firstName": "John",
  "lastName": "Doe",
  "username": "johnd",
  "email": "john@example.com",
  "phoneNumber": "+1000000000",
  "password": "secret"
}</pre>
    <h4>Responses</h4>
    <ul>
      <li>201: <code>{ message, buyer: { id, firstName, lastName, username, email, phoneNumber, emailVerified } }</code></li>
      <li>400: <code>All fields required | Username/Email already exists</code></li>
      <li>500: <code>Error registering buyer</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">GET</span> <code>/api/buyers</code> <span class="pill protected">JWT</span></div>
    <div>List buyers.</div>
  </div>
  <div class="endpoint">
    <div><span class="method">GET</span> <code>/api/buyers/:id</code> <span class="pill protected">JWT</span></div>
    <div>Get buyer by id.</div>
  </div>
  <div class="endpoint">
    <div><span class="method">PATCH</span> <code>/api/buyers/:id</code> <span class="pill protected">JWT (self/admin)</span></div>
    <div>Update buyer fields.</div>
  </div>
  <div class="endpoint">
    <div><span class="method">DELETE</span> <code>/api/buyers/:id</code> <span class="pill protected">JWT (self/admin)</span></div>
    <div>Delete buyer.</div>
  </div>

  <h2>Sellers</h2>

  <div class="endpoint">
    <div><span class="method">POST</span> <code>/api/sellers/register</code> <span class="pill auth">Public</span></div>
    <div>Registers a seller and sends OTP. Login requires emailVerified=true and approved=true.</div>
    <h4>Request body</h4>
<pre>{
  "firstName": "Acme",
  "lastName": "Corp",
  "username": "acme",
  "email": "acme@example.com",
  "password": "secret",
  "address": "123 Main St",
  "license": "LIC-12345"
}</pre>
    <h4>Responses</h4>
    <ul>
      <li>201: <code>{ message, seller: { id, firstName, lastName, username, email, address, approved, emailVerified } }</code></li>
      <li>400: <code>All fields required | Username already taken</code></li>
      <li>500: <code>Error registering seller</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">GET</span> <code>/api/sellers</code> <span class="pill protected">JWT (admin)</span></div>
    <div>Get all sellers. Admin only.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "message": "Sellers retrieved successfully", "sellers": [...] }</code></li>
      <li>401: <code>{ "message": "Unauthorized" }</code></li>
      <li>403: <code>{ "message": "Forbidden" }</code></li>
      <li>500: <code>{ "message": "Error retrieving sellers", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">GET</span> <code>/api/sellers/:id</code> <span class="pill protected">JWT</span></div>
    <div>Get seller by ID. Authenticated users only.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
      <li>Params: <code>id</code> — Seller ID</li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "message": "Seller retrieved successfully", "seller": {...} }</code></li>
      <li>401: <code>{ "message": "Unauthorized" }</code></li>
      <li>404: <code>{ "message": "Seller not found" }</code></li>
      <li>500: <code>{ "message": "Error retrieving seller", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">PUT</span> <code>/api/sellers/:id</code> <span class="pill protected">JWT</span></div>
    <div>Update seller information. Authenticated users only.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
      <li>Params: <code>id</code> — Seller ID</li>
    </ul>
    <h4>Request body (all fields optional)</h4>
<pre>{
  "firstName": "Updated Name",
  "lastName": "Updated Last",
  "email": "updated@example.com",
  "address": "Updated Address",
  "license": "NEW-LIC-123",
  "approved": true
}</pre>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "message": "Seller updated successfully", "seller": {...} }</code></li>
      <li>401: <code>{ "message": "Unauthorized" }</code></li>
      <li>404: <code>{ "message": "Seller not found" }</code></li>
      <li>500: <code>{ "message": "Error updating seller", "error": "..." }</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">DELETE</span> <code>/api/sellers/:id</code> <span class="pill protected">JWT (admin)</span></div>
    <div>Delete seller and corresponding user record. Admin only.</div>
    <h4>Request</h4>
    <ul>
      <li>Headers: <code>Authorization: Bearer &lt;token&gt;</code></li>
      <li>Params: <code>id</code> — Seller ID</li>
    </ul>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ "message": "Seller deleted successfully" }</code></li>
      <li>401: <code>{ "message": "Unauthorized" }</code></li>
      <li>403: <code>{ "message": "Forbidden" }</code></li>
      <li>404: <code>{ "message": "Seller not found" }</code></li>
      <li>500: <code>{ "message": "Error deleting seller", "error": "..." }</code></li>
    </ul>
  </div>

  <h2>Admin</h2>

  <div class="endpoint">
    <div><span class="method">POST</span> <code>/api/admin/login</code> <span class="pill auth">Public</span></div>
    <div>Admin login.</div>
    <h4>Request body</h4>
<pre>{
  "username": "admin or email",
  "password": "secret"
}</pre>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ message, token, user }</code></li>
      <li>400/401/403: <code>All fields required | Invalid password | Forbidden</code></li>
    </ul>
  </div>

  <div class="endpoint">
    <div><span class="method">PATCH</span> <code>/api/admin/sellers/:id/approve</code> <span class="pill protected">JWT (admin)</span></div>
    <div>Approves a seller. Requires admin token.</div>
    <h4>Responses</h4>
    <ul>
      <li>200: <code>{ message: "Seller approved", seller: { id, username, email, approved } }</code></li>
      <li>404: <code>Seller not found</code></li>
      <li>401/403: <code>Unauthorized | Forbidden</code></li>
    </ul>
  </div>

  <h2>Security</h2>
  <ul>
    <li><strong>JWT Secret</strong>: <code>JWT_SECRET</code> env must be configured.</li>
    <li><strong>Auth header</strong>: <code>Authorization: Bearer &lt;token&gt;</code> for protected endpoints.</li>
  </ul>
</body>
</html>
